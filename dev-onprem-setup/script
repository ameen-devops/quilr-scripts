update postgres scripts
delete the resources on azure
check why webhook is geeting failed / github actions need to look upon

---------------------------------------------------------------------------------------------------------------------------------------------

quilradmin@ip-10-71-12-87:~$ helm list -A
NAME                    NAMESPACE       REVISION        UPDATED                                 STATUS          CHART                           APP VERSION
my-neo4j                quilr           5               2025-08-19 16:31:57.053078457 +0000 UTC deployed        neo4j-5.25.1                    5.25.1
quilr-db-elasticsearch  quilr           1               2025-09-04 06:43:25.291974368 +0000 UTC deployed        elasticsearch-21.5.0            8.17.4
quilrprod-postgres-db   quilr           1               2025-09-02 14:02:29.024065252 +0000 UTC deployed        postgresql-16.7.26              17.6.0
redis                   quilr           1               2025-09-04 13:28:00.140802438 +0000 UTC deployed        redis-20.11.5                   7.4.2
vault-operator          quilr           1               2025-09-02 07:28:23.281684758 +0000 UTC deployed        vault-operator-1.23.0           v1.23.0
vault-secrets-webhook   vault-infra     1               2025-09-02 08:04:09.450552342 +0000 UTC deployed        vault-secrets-webhook-1.22.0    v1.22.0

helm uninstall my-neo4j quilr-db-elasticsearch quilrprod-postgres-db redis vault-operator -n quilr

quilradmin@ip-10-71-12-87:~$ kubectl get pvc -n quilr
NAME                       STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   VOLUMEATTRIBUTESCLASS   AGE
elasticsearch-master-pvc   Bound    elasticsearch-master-pv                    5Gi        RWO            manual         <unset>                 8d
kafka-server-pvc           Bound    kafka-server-pv                            10Gi       RWO            manual         <unset>                 9d
neo4j-conf-pvc             Bound    neo4j-conf-pv                              5Gi        RWO            manual         <unset>                 7d6h
neo4j-data-pvc             Bound    neo4j-data-pv                              5Gi        RWO            manual         <unset>                 7d6h
neo4j-plugins-pvc          Bound    neo4j-plugins-pv                           5Gi        RWO            manual         <unset>                 7d6h
postgres-hostpath-pvc      Bound    postgres-hostpath-pv                       10Gi       RWO            manual         <unset>                 10d
redis-master-pvc           Bound    redis-master-pv                            5Gi        RWO            manual         <unset>                 8d
redis-replica-pvc          Bound    redis-replica-pv                           5Gi        RWO            manual         <unset>                 8d
vault-raft-vault-0         Bound    pvc-e4984be5-4874-45c9-b8fd-9ab205dda3b1   1Gi        RWO            local-path     <unset>                 10d
zookeeper-data-pvc         Bound    zookeeper-data-pv                          3Gi        RWO            manual         <unset>                 9d

kubectl delete pvc --all -n quilr

helm uninstall vault-secrets-webhook -n vault-infra
kubectl delete pvc --all -n vault-infra

kubectl delete -f kafka.yaml -n quilr
kubectl delete -f zookeeper.yaml -n quilr
kubectl delete -f kafkaui.yaml -n quilr
---------------------------------------------------------------------------------------------------------------------------------------------
all yamls deployment first

zookeeper
kafka
kafkaui
neo4j

all bitnami helm deployments

redis
postgres
elasticsearch

helm bankvaults deployments

hashicorp vault
---------------------------------------------------------------------------
sudo crictl rmi docker.io/bitnami/kafka:3.5.1
sudo crictl rmi docker.io/bitnamilegacy/zookeeper:3.9.0
sudo crictl rmi docker.io/library/neo4j:5.25.1-community
sudo crictl rmi docker.io/provectuslabs/kafka-ui:latest

sudo crictl rmi docker.io/bitnami/kafka:3.5.1
sudo crictl rmi docker.io/bitnamilegacy/zookeeper:3.9.0
sudo crictl rmi docker.io/library/neo4j:5.25.1-community
sudo crictl rmi docker.io/provectuslabs/kafka-ui:latest
WARN[0000] Config "/etc/crictl.yaml" does not exist, trying next: "/usr/bin/crictl.yaml"
WARN[0000] Image connect using default endpoints: [unix:///run/containerd/containerd.sock unix:///run/crio/crio.sock unix:///var/run/cri-dockerd.sock]. As the default settings are now deprecated, you should set the endpoint instead.
Deleted: docker.io/bitnami/kafka:3.5.1
WARN[0000] Config "/etc/crictl.yaml" does not exist, trying next: "/usr/bin/crictl.yaml"
WARN[0000] Image connect using default endpoints: [unix:///run/containerd/containerd.sock unix:///run/crio/crio.sock unix:///var/run/cri-dockerd.sock]. As the default settings are now deprecated, you should set the endpoint instead.
Deleted: docker.io/bitnamilegacy/zookeeper:3.9.0
WARN[0000] Config "/etc/crictl.yaml" does not exist, trying next: "/usr/bin/crictl.yaml"
WARN[0000] Image connect using default endpoints: [unix:///run/containerd/containerd.sock unix:///run/crio/crio.sock unix:///var/run/cri-dockerd.sock]. As the default settings are now deprecated, you should set the endpoint instead.
Deleted: docker.io/library/neo4j:5.25.1
Deleted: docker.io/library/neo4j:5.25.1-community
WARN[0000] Config "/etc/crictl.yaml" does not exist, trying next: "/usr/bin/crictl.yaml"
WARN[0000] Image connect using default endpoints: [unix:///run/containerd/containerd.sock unix:///run/crio/crio.sock unix:///var/run/cri-dockerd.sock]. As the default settings are now deprecated, you should set the endpoint instead.
Deleted: docker.io/provectuslabs/kafka-ui:latest

----------------------------------------------------------

 sudo crictl rmi \
docker.io/bitnami/elasticsearch:8.17.4-debian-12-r0 \
docker.io/bitnami/os-shell:12-debian-12-r40 \
docker.io/bitnami/os-shell:12-debian-12-r50 \
docker.io/bitnami/redis:7.4.2-debian-12-r6 \
docker.io/bitnami/redis:8.0.3-debian-12-r1 \
docker.io/bitnami/redis:8.2.0-debian-12-r0 \
docker.io/bitnami/postgresql:17.6.0-debian-12-r0 \
docker.io/bitnami/postgresql:17.6.0-debian-12-r4 \
docker.io/bitnamilegacy/postgresql:16 \
docker.io/bitnamilegacy/postgresql:latest \
docker.io/hashicorp/vault:1.14.1 \
docker.io/hashicorp/vault:1.14.8 \
docker.io/library/ubuntu:bionic \
ghcr.io/bank-vaults/bank-vaults:v1.32.0 \
ghcr.io/bank-vaults/vault-operator:v1.23.0 \
ghcr.io/bank-vaults/vault-secrets-webhook:v1.22.0
WARN[0000] Config "/etc/crictl.yaml" does not exist, trying next: "/usr/bin/crictl.yaml"
WARN[0000] Image connect using default endpoints: [unix:///run/containerd/containerd.sock unix:///run/crio/crio.sock unix:///var/run/cri-dockerd.sock]. As the default settings are now deprecated, you should set the endpoint instead.
Deleted: docker.io/hashicorp/vault:1.14.8
E0912 13:48:27.376106 1184960 log.go:32] "RemoveImage from image service failed" err="rpc error: code = DeadlineExceeded desc = context deadline exceeded" image="docker.io/bitnami/os-shell:12-debian-12-r40"
E0912 13:48:27.376121 1184960 log.go:32] "RemoveImage from image service failed" err="rpc error: code = DeadlineExceeded desc = context deadline exceeded" image="docker.io/library/ubuntu:bionic"
E0912 13:48:27.376139 1184960 log.go:32] "RemoveImage from image service failed" err="rpc error: code = DeadlineExceeded desc = context deadline exceeded" image="ghcr.io/bank-vaults/vault-secrets-webhook:v1.22.0"
E0912 13:48:27.376149 1184960 log.go:32] "RemoveImage from image service failed" err="rpc error: code = DeadlineExceeded desc = context deadline exceeded" image="docker.io/bitnamilegacy/postgresql:16"
E0912 13:48:27.376174 1184960 log.go:32] "RemoveImage from image service failed" err="rpc error: code = Unknown desc = failed to delete image reference \"sha256:94f392890b6ffc642b2c4a1b868006decf7f9cf1e10826acd96a897fe20aa756\" for \"sha256:94f392890b6ffc642b2c4a1b868006decf7f9cf1e10826acd96a897fe20aa756\": context deadline exceeded: unknown" image="docker.io/bitnami/elasticsearch:8.17.4-debian-12-r0"
E0912 13:48:27.376184 1184960 log.go:32] "RemoveImage from image service failed" err="rpc error: code = DeadlineExceeded desc = context deadline exceeded" image="docker.io/bitnami/postgresql:17.6.0-debian-12-r0"
E0912 13:48:27.376074 1184960 log.go:32] "RemoveImage from image service failed" err="rpc error: code = DeadlineExceeded desc = context deadline exceeded" image="docker.io/bitnami/redis:7.4.2-debian-12-r6"
E0912 13:48:27.376073 1184960 log.go:32] "RemoveImage from image service failed" err="rpc error: code = DeadlineExceeded desc = context deadline exceeded" image="docker.io/hashicorp/vault:1.14.1"
E0912 13:48:27.376215 1184960 log.go:32] "RemoveImage from image service failed" err="rpc error: code = DeadlineExceeded desc = context deadline exceeded" image="ghcr.io/bank-vaults/bank-vaults:v1.32.0"
E0912 13:48:27.376361 1184960 log.go:32] "RemoveImage from image service failed" err="rpc error: code = DeadlineExceeded desc = context deadline exceeded" image="docker.io/bitnami/redis:8.0.3-debian-12-r1"
E0912 13:48:27.376088 1184960 log.go:32] "RemoveImage from image service failed" err="rpc error: code = DeadlineExceeded desc = context deadline exceeded" image="docker.io/bitnami/os-shell:12-debian-12-r50"
E0912 13:48:27.376090 1184960 log.go:32] "RemoveImage from image service failed" err="rpc error: code = DeadlineExceeded desc = context deadline exceeded" image="docker.io/bitnamilegacy/postgresql:latest"
E0912 13:48:27.376198 1184960 log.go:32] "RemoveImage from image service failed" err="rpc error: code = DeadlineExceeded desc = context deadline exceeded" image="docker.io/bitnami/redis:8.2.0-debian-12-r0"
E0912 13:48:27.376203 1184960 log.go:32] "RemoveImage from image service failed" err="rpc error: code = DeadlineExceeded desc = context deadline exceeded" image="ghcr.io/bank-vaults/vault-operator:v1.23.0"
E0912 13:48:27.376543 1184960 log.go:32] "RemoveImage from image service failed" err="rpc error: code = DeadlineExceeded desc = context deadline exceeded" image="docker.io/bitnami/postgresql:17.6.0-debian-12-r4"
error of removing image "ghcr.io/bank-vaults/vault-secrets-webhook:v1.22.0": rpc error: code = DeadlineExceeded desc = context deadline exceeded
error of removing image "docker.io/bitnami/os-shell:12-debian-12-r40": rpc error: code = DeadlineExceeded desc = context deadline exceeded
error of removing image "docker.io/library/ubuntu:bionic": rpc error: code = DeadlineExceeded desc = context deadline exceeded
error of removing image "docker.io/bitnamilegacy/postgresql:16": rpc error: code = DeadlineExceeded desc = context deadline exceeded
error of removing image "docker.io/bitnami/elasticsearch:8.17.4-debian-12-r0": rpc error: code = Unknown desc = failed to delete image reference "sha256:94f392890b6ffc642b2c4a1b868006decf7f9cf1e10826acd96a897fe20aa756" for "sha256:94f392890b6ffc642b2c4a1b868006decf7f9cf1e10826acd96a897fe20aa756": context deadline exceeded: unknown
error of removing image "docker.io/bitnami/postgresql:17.6.0-debian-12-r0": rpc error: code = DeadlineExceeded desc = context deadline exceeded
error of removing image "ghcr.io/bank-vaults/bank-vaults:v1.32.0": rpc error: code = DeadlineExceeded desc = context deadline exceeded
error of removing image "docker.io/bitnami/redis:8.0.3-debian-12-r1": rpc error: code = DeadlineExceeded desc = context deadline exceeded
error of removing image "docker.io/bitnami/redis:7.4.2-debian-12-r6": rpc error: code = DeadlineExceeded desc = context deadline exceeded
error of removing image "docker.io/bitnami/os-shell:12-debian-12-r50": rpc error: code = DeadlineExceeded desc = context deadline exceeded
error of removing image "docker.io/bitnami/redis:8.2.0-debian-12-r0": rpc error: code = DeadlineExceeded desc = context deadline exceeded
error of removing image "docker.io/hashicorp/vault:1.14.1": rpc error: code = DeadlineExceeded desc = context deadline exceeded
error of removing image "ghcr.io/bank-vaults/vault-operator:v1.23.0": rpc error: code = DeadlineExceeded desc = context deadline exceeded
error of removing image "docker.io/bitnami/postgresql:17.6.0-debian-12-r4": rpc error: code = DeadlineExceeded desc = context deadline exceeded
error of removing image "docker.io/bitnamilegacy/postgresql:latest": rpc error: code = DeadlineExceeded desc = context deadline exceeded

-----------------------------------------------------------------------------------------------------------------------------


kafka  ---> yaml
zookeeper ---> yaml
kafkaui ---> yaml
vault  ----> helm bankvaults

neo4j ---> yaml
redis  ---> helm bitnami
postgres ---> helm bitnami
elasticsearch ---> helm bitnami

process:
---------------
download images
tar the images 
download helm charts / pull the helm charts with specific version
install the helm charts
custom values.yaml make it

sudo crictl images

plugin install
how to see which images are there through helm commands with the chart
download those images
pull the helm charts 
install the component

versions: ( in preprod )
-------------------------------
redis- 20.11.5, chart-7.4.2
postgres- 16.7.26, chart-17.6.0
elasticsearch-21.5.0, chart-8.17.4

helm plugin install https://github.com/nikhilsbhat/helm-images
helm images get oci://registry-1.docker.io/bitnamicharts/redis --output table
helm images get oci://registry-1.docker.io/bitnamicharts/redis --version 20.11.5 --output table
mkdir redis && cd redis
nano redis-values.yaml
sudo ctr -n k8s.io images pull  docker.io/bitnami/redis:7.4.2-debian-12-r6
helm pull oci://registry-1.docker.io/bitnamicharts/redis --version 20.11.5 
tar -xvzf redis-20.11.5.tgz
cd redis

helm upgrade --install redis ./redis-20.11.5.tgz \
  -f redis-values.yaml \
  -n quilr

helm upgrade --install redis ./redis \
  -f ../redis-values.yaml \
  -n quilr

sudo mkdir -p /home/quilradmin/quilr-data/kafka/
sudo mkdir -p /home/quilradmin/quilr-data/zookeeper/
sudo chmod -R 755 /home/quilradmin/quilr-data/kafka
sudo chmod -R 755 /home/quilradmin/quilr-data/zookeeper

kubectl apply -f zookeeper.yaml -n quilr
kubectl apply -f kafka.yaml -n quilr
kubectl apply -f kafkaui.yaml -n quilr

 sudo mkdir -p /home/quilradmin/quilr-data/neo4j/data
 sudo mkdir -p /home/quilradmin/quilr-data/neo4j/conf
 sudo mkdir -p /home/quilradmin/quilr-data/neo4j/plugins
 sudo chown -R 7474:7474 /home/quilradmin/quilr-data/neo4j
 sudo chmod -R 755 /home/quilradmin/quilr-data/neo4j

mkdir neo4j && cd neo4j
wget https://github.com/neo4j/apoc/releases/download/5.25.1/apoc-5.25.1-core.jar
sudo cp apoc-5.25.1-core.jar /home/quilradmin/quilr-data/neo4j/plugins/
sudo chown 7474:7474 /home/quilradmin/quilr-data/neo4j/plugins/apoc-5.25.1-core.jar

kubectl apply -f neo4j-pv.yaml -n quilr
kubectl apply -f neo4j.yaml -n quilr

kubectl create configmap quilr-initdb-scripts \
  --from-file=init-scripts/ \
  -n quilr

helm plugin install https://github.com/nikhilsbhat/helm-images
----------------------------------------------------------------------------------------------------------
helm images get oci://registry-1.docker.io/bitnamicharts/postgres --output table
helm images get oci://registry-1.docker.io/bitnamicharts/postgres --version 16.7.26 --output table

helm images get oci://registry-1.docker.io/bitnamicharts/postgresql \
  --version 16.7.26 \
  --set image.repository=bitnamilegacy/postgresql \
  --set image.tag=16.7.26 \
  --set global.security.allowInsecureImages=true \
  --output table
+-------------------+-------------+--------------------------------------------+
|       Name        |    Kind     |                   Image                    |
+-------------------+-------------+--------------------------------------------+
| sample-postgresql | StatefulSet | docker.io/bitnamilegacy/postgresql:16.7.26 |
+-------------------+-------------+--------------------------------------------+

sudo ctr -n k8s.io images pull docker.io/bitnamilegacy/postgresql:16.7.26
helm pull oci://registry-1.docker.io/bitnamicharts/redis --version 20.11.5 
tar -xvzf redis-20.11.5.tgz
----------------------------------------------------------------------------------------------------------

kubectl create configmap quilr-initdb-scripts \
  --from-file=init-scripts/ \
  -n quilr

helm images get oci://registry-1.docker.io/bitnamicharts/postgresql --output table
helm images get oci://registry-1.docker.io/bitnamicharts/postgresql --version 16.7.27 --output table
sudo ctr -n k8s.io images pull docker.io/bitnami/postgresql:17.6.0-debian-12-r4
helm pull oci://registry-1.docker.io/bitnamicharts/postgresql --version 16.7.27 
tar -xvzf postgresql-16.7.27.tgz

helm upgrade --install quilr ./postgresql \
  -f ../postgres-values.yaml \
  -n quilr

sudo chown -R 1001:1001 /home/quilradmin/quilr-data/postgres
sudo chmod -R 775 /home/quilradmin/quilr-data/postgres
--------------------------------------------------------------------------------------------------------

helm images get oci://registry-1.docker.io/bitnamicharts/elasticsearch --output table
helm images get oci://registry-1.docker.io/bitnamicharts/elasticsearch --version 21.5.0 --output table
sudo ctr -n k8s.io images pull docker.io/bitnami/elasticsearch:8.17.4-debian-12-r0
sudo ctr -n k8s.io images pull docker.io/bitnami/os-shell:12-debian-12-r40
helm pull oci://registry-1.docker.io/bitnamicharts/elasticsearch --version 21.5.0  ( here version is the chart version )
tar -xzvf elasticsearch-21.5.0.tgz 



sudo chown -R 1001:1001 /home/quilradmin/quilr-data/elasticsearch
sudo chmod -R 775 /home/quilradmin/quilr-data/elasticsearch

------------------------------------------------------------------------------------

helm images get oci://ghcr.io/bank-vaults/helm-charts/vault-operator --output table
helm images get oci://ghcr.io/bank-vaults/helm-charts/vault-operator --version 1.23.0 --output table
sudo ctr -n k8s.io images pull ghcr.io/bank-vaults/vault-operator:v1.23.0 
helm pull oci://ghcr.io/bank-vaults/helm-charts/vault-operator --version 1.23.0
tar -xzvf vault-operator-1.23.0.tgz

 helm install vault-operator ./vault-operator-1.23.0.tgz -n quilr

helm images get oci://ghcr.io/bank-vaults/helm-charts/vault-secrets-webhook --output table
helm images get oci://ghcr.io/bank-vaults/helm-charts/vault-secrets-webhook --version 1.22.0 --output table
sudo ctr -n k8s.io images pull  ghcr.io/bank-vaults/vault-secrets-webhook:v1.22.0 
helm pull oci://ghcr.io/bank-vaults/helm-charts/vault-secrets-webhook --version 1.22.0 
tar -xzvf vault-secrets-webhook-1.22.0.tgz

 helm install vault-secrets-webhook ./vault-secrets-webhook-1.22.0.tgz -n quilr

sudo ctr -n k8s.io images pull ghcr.io/bank-vaults/vault-operator:v1.23.0 
sudo ctr -n k8s.io images pull ghcr.io/bank-vaults/bank-vaults:v1.32.0 
sudo ctr -n k8s.io images pull hashicorp/vault:1.14.8
sudo ctr -n k8s.io images pull  ubuntu:bionic 


sudo ctr -n k8s.io images pull  docker.io/bitnami/kafka:3.5.1  ----> image in yaml
#sudo ctr -n k8s.io images pull  docker.io/bitnami/zookeeper:3.9.0 
sudo ctr -n k8s.io images pull  docker.io/bitnamilegacy/zookeeper:3.9.0 ----> image in yaml
sudo ctr -n k8s.io images pull  provectuslabs/kafka-ui:latest ----> image in yaml
sudo ctr -n k8s.io images pull ghcr.io/bank-vaults/vault-operator:v1.23.0 
sudo ctr -n k8s.io images pull ghcr.io/bank-vaults/bank-vaults:v1.32.0 
sudo ctr -n k8s.io images pull hashicorp/vault:1.14.8
sudo ctr -n k8s.io images pull  ubuntu:bionic 
sudo ctr -n k8s.io images pull docker.io/library/neo4j:5.25.1-community
sudo ctr -n k8s.io images pull docker.io/bitnami/redis:8.2.1-debian-12-r0
sudo ctr -n k8s.io images pull docker.io/bitnami/postgresql:17.6.0-debian-12-r0
sudo ctr -n k8s.io images pull docker.io/bitnami/elasticsearch:9.1.2-debian-12-r0
sudo ctr -n k8s.io images pull docker.io/bitnami/os-shell:12-debian-12-r50
